mod base;
mod lb;
mod route;
mod tgin;
mod update;
mod config;

use std::sync::Arc;

use crate::base::{RouteableComponent, UpdaterComponent};
use crate::lb::roundrobin::RoundRobinLB;
use crate::route::longpull::LongPollRoute;
use crate::route::webhook::WebhookRoute;
use crate::tgin::Tgin;
use crate::update::longpull::LongPollUpdate;
use crate::update::webhook::WebhookUpdate;


fn main() {
    // let webhook_update: Box<WebhookUpdate> = Box::new(WebhookUpdate::new("/webhook/bot1".to_string()));
    let longpoll_update: Box<LongPollUpdate> = Box::new(LongPollUpdate::new("...".to_string()));
    let updates: Vec<Box<dyn UpdaterComponent>>= vec![longpoll_update];


    // let route_webhook: Arc<WebhookRoute> = Arc::new(WebhookRoute::new("http://localhost:8081/bot".to_string()));
    let output1: Arc<LongPollRoute> = Arc::new(LongPollRoute::new("/bot1/getUpdates".to_string()));
    let output2: Arc<LongPollRoute> = Arc::new(LongPollRoute::new("/bot2/getUpdates".to_string()));

    let routes: Vec<Arc<dyn RouteableComponent>> = vec![
        // route_webhook as Arc<dyn RouteableComponent>,
        output1 as Arc<dyn RouteableComponent>,
        output2 as Arc<dyn RouteableComponent>,
    ];



    let lb = Arc::new(RoundRobinLB::new(routes));


    let tgin = Tgin::new(updates, lb, 6, Some(3000));

    tgin.run();
}